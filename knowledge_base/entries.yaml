# База знаний alla — известные ошибки и рекомендации по устранению
#
# Формат: YAML-список записей.
# Поля:
#   id               — уникальный slug записи
#   title            — краткое название проблемы
#   description      — подробное описание
#   error_pattern    — подстрока для поиска в тексте ошибки (message + trace)
#   category         — категория причины: test | service | env | data
#   resolution_steps — шаги по устранению

# ============================================================================
# env — проблемы окружения
# ============================================================================

- id: dns_resolution_failure
  title: "Ошибка DNS-резолвинга в тестовом окружении"
  description: "Тесты не могут резолвить DNS-имена сервисов"
  error_pattern: "UnknownHostException"
  category: env
  resolution_steps:
    - "Проверить доступность DNS-серверов: nslookup <service-name>"
    - "Проверить /etc/resolv.conf в контейнерах"

- id: connection_timeout
  title: "Таймаут подключения к сервису"
  description: "Тесты не могут установить TCP-соединение с целевым сервисом"
  error_pattern: "Connection timed out"
  category: env
  resolution_steps:
    - "Проверить доступность сервиса: curl -v <service-url>"
    - "Проверить, что сервис запущен и прошёл health-check"

- id: ssl_certificate_error
  title: "Ошибка SSL-сертификата"
  description: "SSL/TLS handshake завершился с ошибкой"
  error_pattern: "SSLHandshakeException"
  category: env
  resolution_steps:
    - "Проверить срок действия сертификата: openssl s_client -connect <host>:443"
    - "Обновить/перевыпустить сертификат, если просрочен"

# ============================================================================
# service — проблемы в смежном сервисе
# ============================================================================

- id: null_pointer_exception
  title: "NullPointerException в коде приложения"
  description: "Приложение выбрасывает NullPointerException — дефект в коде"
  error_pattern: "NullPointerException"
  category: service
  resolution_steps:
    - "Определить, какой объект оказался null (см. стек-трейс)"
    - "Создать баг-репорт с точным стеком и шагами воспроизведения"

- id: database_deadlock
  title: "Deadlock в базе данных"
  description: "Запрос к БД завершился ошибкой из-за взаимной блокировки"
  error_pattern: "Deadlock found"
  category: service
  resolution_steps:
    - "Проверить, какие таблицы участвуют в deadlock"
    - "Снизить параллелизм тестов, работающих с одними данными"

# ============================================================================
# test — проблемы в тест-коде
# ============================================================================

- id: flaky_assertion_timeout
  title: "Нестабильный тест: таймаут ожидания элемента"
  description: "Тест падает по таймауту при ожидании UI-элемента или условия"
  error_pattern: "TimeoutException"
  category: test
  resolution_steps:
    - "Увеличить explicit wait для нестабильных элементов"
    - "Использовать WebDriverWait вместо Thread.sleep()"

- id: assertion_mismatch
  title: "Ошибка утверждения (assertion) в тесте"
  description: "Ожидаемое значение не совпало с фактическим"
  error_pattern: "AssertionError"
  category: test
  resolution_steps:
    - "Сравнить ожидаемое и фактическое — определить, изменилось ли поведение"
    - "Обновить assertion в тесте, если поведение изменилось намеренно"

# ============================================================================
# data — проблемы тестовых данных
# ============================================================================

- id: missing_test_data
  title: "Отсутствуют тестовые данные"
  description: "Тест не находит необходимые данные (записи в БД, файлы фикстур)"
  error_pattern: "EntityNotFoundException"
  category: data
  resolution_steps:
    - "Проверить, существуют ли ожидаемые тестовые данные в окружении"
    - "Обеспечить изоляцию тестовых данных (отдельный namespace для каждого теста)"
